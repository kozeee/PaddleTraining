<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Google Tag Manager -->
    <script>(function (w, d, s, l, i) {
            w[l] = w[l] || []; w[l].push({
                'gtm.start':
                    new Date().getTime(), event: 'gtm.js'
            }); var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
                    'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-WX59SDH');</script>
    <!-- End Google Tag Manager -->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>

    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WX59SDH" height="0" width="0"
            style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <h1>Checkout Form</h1>
    <form>
        <select name="country" id="country">
        </select>
        <br>
        <input type="email" id="email" placeholder="enter your email address">
        <input type="text" id="postcode" placeholder="enter your postcode">
    </form>
    <button id="checkoutButton">Express Checkout</button>
    <script src="https://cdn.paddle.com/paddle/paddle.js"></script>
    <script type="text/javascript">

        const $ = (x) => document.getElementById(x);
        $('checkoutButton').addEventListener("click", checkoutSetup)
        //populates country dropdown with json list from paddle website
        countryPOP()

        // setup environment and vendor id
        Paddle.Environment.set('sandbox');
        Paddle.Setup({
            vendor: 7617, eventCallback: function (data) {
                if (data.event === 'Checkout.Complete') {
                    console.log(data.eventData)
                    dataLayer.push({
                        'event': 'purchase',
                        'ecommerce': {
                            'currencyCode': data.eventData.checkout.prices.customer.currency,
                            'purchase': {
                                'actionField': {
                                    'id': data.eventData.checkout.id,
                                    'affiliation': 'Your store name',
                                    'revenue': data.eventData.checkout.prices.customer.total,
                                    'tax': data.eventData.checkout.prices.customer.total_tax,
                                    'coupon': data.eventData.checkout.coupon.coupon_code
                                },
                                'products': [{
                                    'name': data.eventData.product.name,
                                    'id': data.eventData.product.id,
                                    'price': data.eventData.checkout.prices.customer.total,
                                    'brand': 'Your brand name',
                                    'quantity': data.eventData.product.quantity
                                }]
                            }
                        }
                    });

                }
                else if (data.event === 'Checkout.Close') {
                    dataLayer.push({ 'event': 'checkoutClose' });
                }
            }
        });

        // updates attributes if user chooses to fill out the form
        function checkoutSetup() {
            let email = $('email').value
            let country = $('country').value
            let postcode = $('postcode').value
            let coupon = 'PADDLEFUN'
            Paddle.Checkout.open({ product: 33429, email: email, country: country, postcode: postcode, coupon: coupon })
        }

        function countryPOP() {
            let countryDB = {
                "Afghanistan": "AF",
                "Aland Islands": "AX",
                "Albania": "AL",
                "Algeria": "DZ",
                "American Samoa": "AS",
                "Andorra": "AD",
                "Angola": "AO",
                "Anguilla": "AI",
                "Antigua and Barbuda": "AG",
                "Argentina": "AR",
                "Armenia": "AM",
                "Aruba": "AW",
                "Australia": "AU",
                "Austria": "AT",
                "Azerbaijan": "AZ",
                "Bahamas": "BS",
                "Bahrain": "BH",
                "Bangladesh": "BD",
                "Barbados": "BB",
                "Belarus": "BY",
                "Belgium": "BE",
                "Belize": "BZ",
                "Benin": "BJ",
                "Bermuda": "BM",
                "Bhutan": "BT",
                "Bolivia": "BO",
                "Bonaire, Sint Eustatius and Saba": "BQ",
                "Bosnia and Herzegovina": "BA",
                "Botswana": "BW",
                "Bouvet Island": "BV",
                "Brazil": "BR",
                "Brit. Indian Ocean": "IO",
                "British Virgin Islands": "VG",
                "Brunei": "BN",
                "Bulgaria": "BG",
                "Burkina Faso": "BF",
                "Burundi": "BI",
                "Cambodia": "KH",
                "Cameroon": "CM",
                "Canada": "CA",
                "Cape Verde": "CV",
                "Cayman Islands": "KY",
                "Central African Republic": "CF",
                "Chad": "TD",
                "Chile": "CL",
                "China": "CN",
                "Christmas Island": "CX",
                "Cocos Islands": "CC",
                "Colombia": "CO",
                "Comoros": "KM",
                "Cook Islands": "CK",
                "Costa Rica": "CR",
                "Cote D’Ivoire": "CI",
                "Croatia": "HR",
                "Curaçao": "CW",
                "Cyprus": "CY",
                "Czech Republic": "CZ",
                "Denmark": "DK",
                "Djibouti": "DJ",
                "Dominica": "DM",
                "Dominican Republic": "DO",
                "Ecuador": "EC",
                "Egypt": "EG",
                "El Salvador": "SV",
                "Equatorial Guinea": "GQ",
                "Eritrea": "ER",
                "Estonia": "EE",
                "Ethiopia": "ET",
                "Falkland Islands": "FK",
                "Faroe Islands": "FO",
                "Fiji": "FJ",
                "Finland": "FI",
                "France": "FR",
                "French Guiana": "GF",
                "French Polynesia": "PF",
                "French Southern Terr.": "TF",
                "Gabon": "GA",
                "Gambia": "GM",
                "Georgia": "GE",
                "Germany": "DE",
                "Ghana": "GH",
                "Gibraltar": "GI",
                "Greece": "GR",
                "Greenland": "GL",
                "Grenada": "GD",
                "Guadeloupe": "GP",
                "Guam": "GU",
                "Guatemala": "GT",
                "Guernsey": "GG",
                "Guinea": "GN",
                "Guinea-Bissau": "GW",
                "Guyana": "GY",
                "Haiti": "HT",
                "Heard/ Mcdonald Islands": "HM",
                "Holy See/ Vatican City": "VA",
                "Honduras": "HN",
                "Hong Kong": "HK",
                "Hungary": "HU",
                "Iceland": "IS",
                "India": "IN",
                "Indonesia": "ID",
                "Iraq": "IQ",
                "Ireland": "IE",
                "Isle of Man": "IM",
                "Israel": "IL",
                "Italy": "IT",
                "Jamaica": "JM",
                "Japan": "JP",
                "Jersey": "JE",
                "Jordan": "JO",
                "Kazakhstan": "KZ",
                "Kenya": "KE",
                "Kiribati": "KI",
                "Kuwait": "KW",
                "Kyrgyzstan": "KG",
                "Lao People’s DR": "LA",
                "Latvia": "LV",
                "Lebanon": "LB",
                "Lesotho": "LS",
                "Liberia": "LR",
                "Liechtenstein": "LI",
                "Lithuania": "LT",
                "Luxembourg": "LU",
                "Macao": "MO",
                "Macedonia": "MK",
                "Madagascar": "MG",
                "Malawi": "MW",
                "Malaysia": "MY",
                "Maldives": "MV",
                "Mali": "ML",
                "Malta": "MT",
                "Marshall Islands": "MH",
                "Martinique": "MQ",
                "Mauritania": "MR",
                "Mauritius": "MU",
                "Mayotte": "YT",
                "Mexico": "MX",
                "Micronesia": "FM",
                "Moldova": "MD",
                "Monaco": "MC",
                "Mongolia": "MN",
                "Montenegro": "ME",
                "Montserrat": "MS",
                "Morocco": "MA",
                "Mozambique": "MZ",
                "Myanmar": "MM",
                "Namibia": "NA",
                "Nauru": "NR",
                "Nepal": "NP",
                "Netherlands": "NL",
                "Netherlands Antilles": "AN",
                "New Caledonia": "NC",
                "New Zealand": "NZ",
                "Niger": "NE",
                "Nigeria": "NG",
                "Niue": "NU",
                "Norfolk Island": "NF",
                "Northern Mariana Islands": "MP",
                "Norway": "NO",
                "Oman": "OM",
                "Pakistan": "PK",
                "Palau": "PW",
                "Palestinian Territory": "PS",
                "Panama": "PA",
                "Papua New Guinea": "PG",
                "Paraguay": "PY",
                "Peru": "PE",
                "Philippines": "PH",
                "Pitcairn": "PN",
                "Poland": "PL",
                "Portugal": "PT",
                "Puerto Rico": "PR",
                "Qatar": "QA",
                "Republic of Congo": "CG",
                "Republic of Serbia": "RS",
                "Reunion": "RE",
                "Romania": "RO",
                "Russian Federation": "RU",
                "Rwanda": "RW",
                "S. Georgia/ Sandwich Islands": "GS",
                "Saint Helena": "SH",
                "Saint Kitts and Nevis": "KN",
                "Saint Lucia": "LC",
                "Saint Martin": "MF",
                "Saint Pierre and Miquelon": "PM",
                "Saint Vincent/ Grenadines": "VC",
                "Samoa": "WS",
                "San Marino": "SM",
                "Sao Tome and Principe": "ST",
                "Saudi Arabia": "SA",
                "Senegal": "SN",
                "Seychelles": "SC",
                "Sierra Leone": "SL",
                "Singapore": "SG",
                "Slovakia": "SK",
                "Slovenia": "SI",
                "Solomon Islands": "SB",
                "South Africa": "ZA",
                "South Korea": "KR",
                "Spain": "ES",
                "Sri Lanka": "LK",
                "Sudan": "SD",
                "Suriname": "SR",
                "Svalbard and Jan Mayen": "SJ",
                "Swaziland": "SZ",
                "Sweden": "SE",
                "Switzerland": "CH",
                "Taiwan": "TW",
                "Tajikistan": "TJ",
                "Tanzania": "TZ",
                "Thailand": "TH",
                "Timor-Leste": "TL",
                "Togo": "TG",
                "Tokelau": "TK",
                "Tonga": "TO",
                "Trinidad and Tobago": "TT",
                "Tunisia": "TN",
                "Turkey": "TR",
                "Turkmenistan": "TM",
                "Turks and Caicos Islands": "TC",
                "Tuvalu": "TV",
                "U.S. Virgin Islands": "VI",
                "Uganda": "UG",
                "Ukraine": "UA",
                "United Arab Emirates": "AE",
                "United Kingdom": "GB",
                "United States": "US",
                "United States (M.O.I.)": "UM",
                "Uruguay": "UY",
                "Uzbekistan": "UZ",
                "Vanuatu": "VU",
                "Vietnam": "VN",
                "Wallis and Futuna": "WF",
                "Western Sahara": "EH",
                "Zambia": "ZM",
                "Zimbabwe": "ZW"
            }
            for (country in countryDB) {
                var x = $('country')
                var opt = document.createElement("option")
                opt.text = country
                opt.value = countryDB[country]
                x.add(opt)
            }
        }
    </script>

</body>

</html>